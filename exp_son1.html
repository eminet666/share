<!-- https://glitch.com/~gftruj-aframe-twosounds -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Hello!</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <script>
      AFRAME.registerComponent("button", {
        init: function() {
          let meowBox = document.querySelector("#meowBox");
          let barkBox = document.querySelector("#barkBox");
          let playing = false;

          meowBox.addEventListener("sound-ended", e => {
            meowBox.setAttribute("color", "red");
            barkBox.setAttribute("color", "green");
            console.log(">>>> son fini "+meowBox.id);
            barkBox.components.sound.playSound();
          });

          barkBox.addEventListener("sound-ended", e => {
            barkBox.setAttribute("color", "red");
            console.log(">>>> son fini "+barkBox.id);
            playing = false;
          });

          barkBox.addEventListener("sound-loaded", () => {
            console.log(">>>> son chargé "+barkBox.id);
          });

          meowBox.addEventListener("sound-loaded", () => {
            console.log(">>>> son chargé "+meowBox.id);
          });

          this.el.addEventListener("click", e => {
            if (playing) return;
            playing = true;

            meowBox.components.sound.playSound();
            meowBox.setAttribute("color", "green");
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene cursor="rayOrigin: mouse">
        <a-assets>
          <audio id="son" src="./assets/audio/son.mp3" preload="auto"></audio>
          <audio id="bark" src="./assets/audio/toto.mp3" preload="auto"></audio>
        </a-assets>

      <a-box button position="-1.25 1 -3" color="blue">
      </a-box>
      <a-box id="meowBox" position="0 1 -3" sound="src: #son" color="red">
      </a-box>
      <a-box id="barkBox" position="1.25 1 -3" sound="src: #bark" color="red">
      </a-box>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>

  </body>
</html>
